kapacitor
=========

[![Build Status](https://travis-ci.org/kbrebanov/ansible-kapacitor.svg?branch=master)](https://travis-ci.org/kbrebanov/ansible-kapacitor)

Installs and configures Kapacitor.

Requirements
------------

This role requires Ansible 1.9 or higher.

Role Variables
--------------

| Name                                           | Default                                                                                                              | Description                                                                                                                                                 |
|:-----------------------------------------------|:---------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------|
| kapacitor_version                              | 1.0.0                                                                                                                | Version of Kapacitor to install                                                                                                                             |
| kapacitor_release_channel                      | stable                                                                                                               | Release channel of Kapacitor (stable or unstable)                                                                                                           |
| kapacitor_hostname                             | localhost                                                                                                            | The hostname of this node. Must be resolvable by any configured InfluxDB hosts.                                                                             |
| kapacitor_data_dir                             | /var/lib/kapacitor                                                                                                   | Directory for storing a small amount of metadata about the server.                                                                                          |
| kapacitor_http_bind_address                    | ":9092"                                                                                                              |                                                                                                                                                             |
| kapacitor_http_auth_enabled                    | false                                                                                                                |                                                                                                                                                             |
| kapacitor_http_log_enabled                     | true                                                                                                                 |                                                                                                                                                             |
| kapacitor_http_write_tracing                   | false                                                                                                                |                                                                                                                                                             |
| kapacitor_http_pprof_enabled                   | false                                                                                                                |                                                                                                                                                             |
| kapacitor_http_https_enabled                   | false                                                                                                                |                                                                                                                                                             |
| kapacitor_http_https_certificate               | /etc/ssl/kapacitor.pem                                                                                               |                                                                                                                                                             |
| kapacitor_logging_file                         | /var/log/kapacitor/kapacitor.log                                                                                     | Destination for logs. Can be a path to a file or 'STDOUT', 'STDERR'.                                                                                        |
| kapacitor_logging_level                        | INFO                                                                                                                 | Logging level can be one of: DEBUG, INFO, WARN, ERROR or OFF                                                                                                |
| kapacitor_replay_dir                           | /var/lib/kapacitor/replay                                                                                            | Where to store replay files, aka recordings.                                                                                                                |
| kapacitor_storage_boltdb                       | /var/lib/kapacitor/kapacitor.db                                                                                      | Where to store the Kapacitor boltdb database                                                                                                                |
| kapacitor_deadman_global                       | false                                                                                                                | Globally configure deadman's switches on all stream tasks. NOTE: for this to be of use you must also globally configure at least one alerting method.       |
| kapacitor_deadman_threshold                    | 0.0                                                                                                                  | Threshold, if globally configured the alert will be triggered if the throughput in points/interval is <= threshold.                                         |
| kapacitor_deadman_interval                     | 10s                                                                                                                  | Interval, if globally configured the frequency at which to check the throughput.                                                                            |
| kapacitor_deadman_id                           | "{% raw %}node 'NODE_NAME' in taks '{{ .TaskName }}'{% endraw %}"                                                    | Id -- the alert Id, NODE_NAME will be replaced with the name of the node being monitored.                                                                   |
| kapacitor_deadman_message                      | "{% raw %}{{ .ID }} is {{ if eq .Level \\\"OK\\\" }}alive{{ else }}dead{{ end }}: {{ index .Fields \\\"collected\\\" | printf \\\"%0.3f\\\" }} points/INTERVAL.{% endraw %}" | The message of the alert. INTERVAL will be replaced by the interval.                                |
| kapacitor_influxdb_enabled                     | false                                                                                                                | Connect to an InfluxDB cluster                                                                                                                              |
| kapacitor_influxdb_default                     | true                                                                                                                 |                                                                                                                                                             |
| kapacitor_influxdb_name                        | localhost                                                                                                            |                                                                                                                                                             |
| kapacitor_influxdb_urls                        | ["http://localhost:8086"]                                                                                            |                                                                                                                                                             |
| kapacitor_influxdb_username                    | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_influxdb_password                    | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_influxdb_timeout                     | 0                                                                                                                    |                                                                                                                                                             |
| kapacitor_influxdb_ssl_ca                      | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_influxdb_ssl_cert                    | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_influxdb_ssl_key                     | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_influxdb_insecure_skip_verify        | false                                                                                                                | Do not verify the TLS/SSL certificate. This is insecure.                                                                                                    |
| kapacitor_influxdb_startup_timeout             | 5m                                                                                                                   | Maximum time to try and connect to InfluxDB during startup                                                                                                  |
| kapacitor_influxdb_disable_subscriptions       | false                                                                                                                | Turn off all subscriptions                                                                                                                                  |
| kapacitor_influxdb_subscription_protocol       | http                                                                                                                 | Which protocol to use for subscriptions (udp, http or https)                                                                                                |
| kapacitor_influxdb_subscriptions_sync_interval | 1m0s                                                                                                                 | Subscriptions resync time interval. Useful if you want to subscribe to new created databases without restart Kapacitord                                     |
| kapacitor_influxdb_udp_bind                    | ''                                                                                                                   | Host part of a bind address for UDP listeners. Default empty value binds to all addresses                                                                   |
| kapacitor_influxdb_udp_buffer                  | 1000                                                                                                                 | Number of packets to buffer when reading packets off the socket.                                                                                            |
| kapacitor_influxdb_udp_read_buffer             | 0                                                                                                                    | The size in bytes of the OS read buffer for the UDP socket. A value of 0 indicates use the OS default.                                                      |
| kapacitor_influxdb_subscriptions               | {}                                                                                                                   | Set of databases and retention policies to subscribe to. If empty will subscribe to all, minus the list in excluded subscriptions                           |
| kapacitor_influxdb_excluded_subscriptions      | {}                                                                                                                   | Set of databases and retention policies to exclude from the subscriptions. If subscriptions is empty it will subscribe to all except databases listed here. |
| kapacitor_smtp_enabled                         | false                                                                                                                | Enable SMTP                                                                                                                                                 |
| kapacitor_smtp_host                            | localhost                                                                                                            |                                                                                                                                                             |
| kapacitor_smtp_port                            | 25                                                                                                                   |                                                                                                                                                             |
| kapacitor_smtp_username                        | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_smtp_password                        | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_smtp_from                            | ''                                                                                                                   | From address for outgoing mail                                                                                                                              |
| kapacitor_smtp_to                              | []                                                                                                                   | List of default To addresses.                                                                                                                               |
| kapacitor_smtp_no_verify                       | false                                                                                                                | Skip TLS certificate verify when connecting to SMTP server                                                                                                  |
| kapacitor_smtp_idle_timeout                    | 30s                                                                                                                  | Close idle connections after timeout                                                                                                                        |
| kapacitor_smtp_global                          | false                                                                                                                | If true all the alerts will be sent via Email                                                                                                               |
| kapacitor_smtp_state_changes_only              | false                                                                                                                | Only applies if global is true. Sets all alerts in state-changes-only mode, meaning alerts will only be sent if the alert state changes.                    |
| kapacitor_opsgenie_enabled                     | false                                                                                                                | Enable OpsGenie                                                                                                                                             |
| kapacitor_opsgenie_api_key                     | ''                                                                                                                   | OpsGenie API key                                                                                                                                            |
| kapacitor_opsgenie_teams                       | []                                                                                                                   | Default OpsGenie teams, can be overridden per alert.                                                                                                        |
| kapacitor_opsgenie_recipients                  | []                                                                                                                   | Default OpsGenie recipients, can be overridden per alert.                                                                                                   |
| kapacitor_opsgenie_url                         | https://api.opsgenie.com/v1/json/alert                                                                               | The OpsGenie API URL                                                                                                                                        |
| kapacitor_opsgenie_recovery_url                | https://api.opsgenie.com/v1/json/alert/note                                                                          | The OpsGenie Recovery URL, you can change this based on which behavior you want a recovery to trigger (Add Notes, Close Alert, etc.)                        |
| kapacitor_opsgenie_global                      | false                                                                                                                | If true then all alerts will be sent to OpsGenie                                                                                                            |
| kapacitor_victorops_enabled                    | false                                                                                                                | Enable VictorOps                                                                                                                                            |
| kapacitor_victorops_api_key                    | ''                                                                                                                   | VictorOps API key                                                                                                                                           |
| kapacitor_victorops_routing_key                | ''                                                                                                                   | Default VictorOps routing key, can be overridden per alert.                                                                                                 |
| kapacitor_victorops_url                        | https://alert.victorops.com/integrations/generic/20131114/alert                                                      | VictorOps API URL                                                                                                                                           |
| kapacitor_victorops_global                     | false                                                                                                                | If true then all alerts will be sent to VictorOps                                                                                                           |
| kapacitor_pagerduty_enabled                    | false                                                                                                                | Enable PagerDuty                                                                                                                                            |
| kapacitor_pagerduty_service_key                | ''                                                                                                                   | PagerDuty Service Key                                                                                                                                       |
| kapacitor_pagerduty_url                        | https://events.pagerduty.com/generic/2010-04-15/create_event.json                                                    | PagerDuty API URL                                                                                                                                           |
| kapacitor_pagerduty_global                     | false                                                                                                                | If true then all alerts will be sent to PagerDuty                                                                                                           |
| kapacitor_slack_enabled                        | false                                                                                                                | Enable Slack                                                                                                                                                |
| kapacitor_slack_url                            | ''                                                                                                                   | The Slack webhook URL, can be obtained by adding an Incoming Webhook integration                                                                            |
| kapacitor_slack_channel                        | ''                                                                                                                   | Default channel for messages                                                                                                                                |
| kapacitor_slack_global                         | false                                                                                                                | If true then all alerts will be sent to Slack                                                                                                               |
| kapacitor_slack_state_changes_only             | false                                                                                                                | Only applies if global is true. Sets all alerts in state-changes-only mode, meaning alerts will only be sent if the alert state changes.                    |
| kapacitor_telegram_enabled                     | false                                                                                                                | Enable Telegram                                                                                                                                             |
| kapacitor_telegram_url                         | https://api.telegram.org/bot                                                                                         | The Telegram Bot URL. Should not need to be changed                                                                                                         |
| kapacitor_telegram_token                       | ''                                                                                                                   | Telegram bot token, can be obtained from @BotFather                                                                                                         |
| kapacitor_telegram_chat_id                     | ''                                                                                                                   | Default recipient for messages, contact @myidbot on Telegram to get an ID                                                                                   |
| kapacitor_telegram_parse_mode                  | Markdown                                                                                                             | Send (Markdown or HTML), if you want Telegram apps to show bold, italic, fixed-width or inline URLs in your alert messages                                  |
| kapacitor_telegram_disable_web_page_preview    | false                                                                                                                | Disable link previews for links                                                                                                                             |
| kapacitor_telegram_disable_notification        | false                                                                                                                | Sends the messages silently. iOS users will not receive a notification, Android users will receive a notification with no sound                             |
| kapacitor_telegram_global                      | false                                                                                                                | If enabled, all alerts will be sent to Telegram without explicitly marking them in the TICKscript                                                           |
| kapacitor_telegram_state_changes_only          | false                                                                                                                | Only applies if global is true. Sets all alerts in state-changes-only mode, meaning alerts will only be sent if the alert state changes                     |
| kapacitor_hipchat_enabled                      | false                                                                                                                | Enable HipChat                                                                                                                                              |
| kapacitor_hipchat_url                          | https://subdomain.hipchat.com/v2/room                                                                                | HipChat API URL. Replace subdomain with your HipChat subdomain.                                                                                             |
| kapacitor_hipchat_room                         | ''                                                                                                                   | Default room for messages                                                                                                                                   |
| kapacitor_hipchat_token                        | ''                                                                                                                   | Default authentication token                                                                                                                                |
| kapacitor_hipchat_global                       | false                                                                                                                | If true then all alerts will be sent to HipChat                                                                                                             |
| kapacitor_hipchat_state_changes_only           | false                                                                                                                | Only applies if global is true. Sets all alerts in state-changes-only mode, meaning alerts will only be sent if the alert state changes.                    |
| kapacitor_alerta_enabled                       | false                                                                                                                | Enable Alerta                                                                                                                                               |
| kapacitor_alerta_url                           | ''                                                                                                                   | Alerta URL                                                                                                                                                  |
| kapacitor_alerta_token                         | ''                                                                                                                   | Default authentication token                                                                                                                                |
| kapacitor_alerta_environment                   | ''                                                                                                                   | Default environment                                                                                                                                         |
| kapacitor_alerta_origin                        | Kapacitor                                                                                                            | Default origin                                                                                                                                              |
| kapacitor_sensu_enabled                        | false                                                                                                                | Enable Sensu                                                                                                                                                |
| kapacitor_sensu_addr                           | "sensu-client:3030"                                                                                                  | Sensu Client host:port address                                                                                                                              |
| kapacitor_sensu_source                         | Kapacitor                                                                                                            | Default JIT source                                                                                                                                          |
| kapacitor_reporting_enabled                    | true                                                                                                                 | Send anonymous usage statistics every 12 hours to Enterprise                                                                                                |
| kapacitor_reporting_url                        | https://usage.influxdata.com                                                                                         |                                                                                                                                                             |
| kapacitor_stats_enabled                        | true                                                                                                                 | Emit internal statistics about Kapacitor                                                                                                                    |
| kapacitor_stats_interval                       | 10s                                                                                                                  |                                                                                                                                                             |
| kapacitor_stats_database                       | _kapacitor                                                                                                           |                                                                                                                                                             |
| kapacitor_stats_retention_policy               | autogen                                                                                                              |                                                                                                                                                             |
| kapacitor_talk_enabled                         | false                                                                                                                | Enable Talk                                                                                                                                                 |
| kapacitor_talk_url                             | https://jianliao.com/v2/services/webhook/uuid                                                                        | Talk webhook URL                                                                                                                                            |
| kapacitor_talk_author_name                     | Kapacitor                                                                                                            | Default author name                                                                                                                                         |
| kapacitor_input_collectd_enabled               | false                                                                                                                |                                                                                                                                                             |
| kapacitor_input_collectd_bind_address          | ":25826"                                                                                                             |                                                                                                                                                             |
| kapacitor_input_collectd_database              | collectd                                                                                                             |                                                                                                                                                             |
| kapacitor_input_collectd_retention_policy      | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_input_collectd_batch_size            | 1000                                                                                                                 |                                                                                                                                                             |
| kapacitor_input_collectd_batch_pending         | 5                                                                                                                    |                                                                                                                                                             |
| kapacitor_input_collectd_batch_timeout         | 10s                                                                                                                  |                                                                                                                                                             |
| kapacitor_input_collectd_typesdb               | /usr/share/collectd/types.db                                                                                         |                                                                                                                                                             |
| kapacitor_input_opentsdb_enabled               | false                                                                                                                |                                                                                                                                                             |
| kapacitor_input_opentsdb_bind_address          | ":4242"                                                                                                              |                                                                                                                                                             |
| kapacitor_input_opentsdb_database              | opentsdb                                                                                                             |                                                                                                                                                             |
| kapacitor_input_opentsdb_retention_policy      | ''                                                                                                                   |                                                                                                                                                             |
| kapacitor_input_opentsdb_consistency_level     | one                                                                                                                  |                                                                                                                                                             |
| kapacitor_input_opentsdb_tls_enabled           | false                                                                                                                |                                                                                                                                                             |
| kapacitor_input_opentsdb_certifciate           | /etc/ssl/influxdb.pem                                                                                                |                                                                                                                                                             |
| kapacitor_input_opentsdb_batch_size            | 1000                                                                                                                 |                                                                                                                                                             |
| kapacitor_input_collectd_batch_pending         | 5                                                                                                                    |                                                                                                                                                             |
| kapacitor_input_opentsdb_batch_timeout         | 1s                                                                                                                   |                                                                                                                                                             |

Dependencies
------------

None

Example Playbook
----------------

Install Kapacitor
```yaml
- hosts: all
  roles:
    - name: kbrebanov.kapacitor
```

License
-------

BSD

Author Information
------------------

Kevin Brebanov
